---
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/Navbar.astro";
import StatsCards from "../components/StatsCards.astro";
import ActionButtons from "../components/ActionButtons.astro";
import SearchAndFilters from "../components/SearchAndFilters.astro";
import FoodsList from "../components/FoodsList.astro";
import FoodModal from "../components/FoodModal.astro";
import LocationsModal from "../components/LocationsModal.astro";
import Toast from "../components/Toast.astro";
---

<Layout title="Dashboard - Alimentos de Emergencia">
  <div>
    <!-- Navbar -->
    <Navbar />

    <!-- Contenido principal -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
      <!-- Estadísticas -->
      <StatsCards />

      <!-- Botones de acción -->
      <ActionButtons />

      <!-- Controles de búsqueda y filtros -->
      <SearchAndFilters />

      <!-- Lista de alimentos -->
      <FoodsList />
    </main>

    <!-- Modales -->
    <FoodModal />
    <LocationsModal />

    <!-- Toast para notificaciones -->
    <Toast />
  </div>
</Layout>

<script>
  import { initializeDashboard, resetDashboard } from "../scripts/dashboard.js";
  
  // Función para inicializar el dashboard
  function setupDashboard() {
    initializeDashboard();
  }
  
  // Resetear antes de cada navegación
  function cleanupDashboard() {
    resetDashboard();
  }
  
  // Inicializar en la carga inicial y en cada navegación
  document.addEventListener('DOMContentLoaded', setupDashboard);
  document.addEventListener('astro:page-load', setupDashboard);
  document.addEventListener('astro:before-preparation', cleanupDashboard);
</script>
