---
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/Navbar.astro";
import RecipesList from "../components/RecipesList.astro";
import RecipesModal from "../components/RecipesModal.astro";
import Toast from "../components/Toast.astro";
---

<Layout title="Recetas - Alimentos de Emergencia">
  <div>
    <!-- Navbar -->
    <Navbar />

    <!-- Contenido principal -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
      <!-- Header con estad√≠sticas de recetas -->
      <div class="mb-6">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
          <!-- Total recetas -->
          <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
              <div class="flex items-center">
                <div class="flex-shrink-0">
                  <div class="text-2xl">üìù</div>
                </div>
                <div class="ml-5 w-0 flex-1">
                  <dl>
                    <dt class="text-sm font-medium text-gray-500 truncate">
                      Total Recetas
                    </dt>
                    <dd
                      class="text-lg font-medium text-gray-900"
                      id="total-recipes"
                    >
                      0
                    </dd>
                  </dl>
                </div>
              </div>
            </div>
          </div>

          <!-- Recetas disponibles -->
          <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
              <div class="flex items-center">
                <div class="flex-shrink-0">
                  <div class="text-2xl">‚úÖ</div>
                </div>
                <div class="ml-5 w-0 flex-1">
                  <dl>
                    <dt class="text-sm font-medium text-gray-500 truncate">
                      Disponibles
                    </dt>
                    <dd
                      class="text-lg font-medium text-green-600"
                      id="available-recipes"
                    >
                      0
                    </dd>
                  </dl>
                </div>
              </div>
            </div>
          </div>

          <!-- Porciones totales -->
          <div class="bg-white overflow-hidden shadow rounded-lg">
            <div class="p-5">
              <div class="flex items-center">
                <div class="flex-shrink-0">
                  <div class="text-2xl">üçΩÔ∏è</div>
                </div>
                <div class="ml-5 w-0 flex-1">
                  <dl>
                    <dt class="text-sm font-medium text-gray-500 truncate">
                      Porciones Totales
                    </dt>
                    <dd
                      class="text-lg font-medium text-blue-600"
                      id="total-servings"
                    >
                      0
                    </dd>
                  </dl>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Lista de recetas -->
      <RecipesList />
    </main>

    <!-- Modal de recetas -->
    <RecipesModal />

    <!-- Toast para notificaciones -->
    <Toast />
  </div>
</Layout>

<script>
  import { initializeRecipes, resetRecipes } from "../scripts/recipes.js";

  // Funci√≥n para inicializar las recetas
  function setupRecipes() {
    initializeRecipes();
  }

  // Resetear antes de cada navegaci√≥n
  function cleanupRecipes() {
    resetRecipes();
  }

  // Inicializar en la carga inicial y en cada navegaci√≥n
  document.addEventListener("DOMContentLoaded", setupRecipes);
  document.addEventListener("astro:page-load", setupRecipes);
  document.addEventListener("astro:before-preparation", cleanupRecipes);
</script>
